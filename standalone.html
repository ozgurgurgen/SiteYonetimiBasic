<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <title>Site Aidat Takip</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 0; padding: 1rem; background:#f5f5f5; }
    h1 { margin-top:0; color:#333; }
    .grid { display: grid; grid-template-columns: 150px repeat(12, 80px) 50px; gap:2px; align-items: stretch; margin: 1rem 0; }
    .header { background:#4472c4; color:white; font-weight:bold; padding:8px; text-align:center; font-size:12px; }
    .cell { background:#fff; padding:6px; text-align:center; font-size:12px; border: 1px solid #ddd; cursor:pointer; }
    .name-cell { text-align:left; padding-left:8px; font-weight:bold; }
    .paid { background:#70ad47; color:white; }
    .unpaid { background:#e74c3c; color:white; }
    .controls { display:grid; grid-template-columns: 1fr 1fr 2fr; gap:1rem; margin-bottom:1rem; }
    fieldset { border:1px solid #ccc; padding:1rem; background:#fff; }
    fieldset legend { font-weight:bold; color:#333; }
    table { width:100%; border-collapse:collapse; margin-top:1rem; background:white; }
    th, td { padding:8px; border:1px solid #ddd; font-size:13px; }
    th { background:#e74c3c; color:white; }
    tbody tr:hover { background:#fdf2f2; }
    .summary { display:flex; gap:1rem; margin-top:1rem; }
    .summary div { background:#fff; padding:1rem; border-radius:4px; box-shadow:0 2px 4px rgba(0,0,0,.1); text-align:center; }
    .summary div strong { display:block; margin-bottom:0.5rem; color:#333; }
    .summary div span { font-size:1.2em; font-weight:bold; }
    .income { color:#27ae60; }
    .expense { color:#e74c3c; }
    .balance { color:#2980b9; }
    button { padding:6px 12px; cursor:pointer; background:#3498db; color:white; border:none; border-radius:3px; }
    button:hover { background:#2980b9; }
    input { padding:6px; border:1px solid #ddd; border-radius:3px; margin:2px; }
    .delete-btn { background:#e74c3c; font-size:10px; padding:2px 6px; }
    .delete-btn:hover { background:#c0392b; }
  </style>
</head>
<body>
  <h1>YAZIRAY SİTESİ B BLOK - <span id="year">2025</span></h1>
  
  <div class="controls">
    <fieldset>
      <legend>Ayarlar</legend>
      <label>Aidat (₺): <input type="number" id="monthlyFee" value="100" style="width:80px"></label><br><br>
      <label>Önceki Yıl Devir (₺): <input type="number" id="previousCarry" value="0" style="width:100px"></label><br><br>
      <label>Yıl: <input type="number" id="setYear" value="2025" style="width:70px"></label><br><br>
      <button id="saveSettings">Kaydet</button>
    </fieldset>
    
    <fieldset>
      <legend>Üye Ekle</legend>
      <input type="text" id="newMemberName" placeholder="İsim" />
      <button id="addMember">Ekle</button>
    </fieldset>
    
    <fieldset>
      <legend>Gider Ekle</legend>
      <input type="date" id="expenseDate" />
      <input type="text" id="expenseType" placeholder="Tür" style="width:80px" />
      <input type="text" id="expenseDesc" placeholder="Açıklama" style="width:160px" />
      <input type="number" id="expenseAmount" placeholder="Tutar" style="width:80px" />
      <button id="addExpense">Kaydet</button>
    </fieldset>
  </div>

  <div id="membersTable"></div>

  <h2>Giderler - <span id="expenseYear">2025</span></h2>
  <table id="expensesTbl">
    <thead>
      <tr><th>Tarih</th><th>Gider Türü</th><th>Açıklama</th><th>Tutar (₺)</th><th></th></tr>
    </thead>
    <tbody></tbody>
  </table>

  <div class="summary">
    <div><strong>Aidat Toplam</strong><br><span id="sumCollected" class="income">0,00 ₺</span></div>
    <div><strong>Kasa</strong><br><span id="sumBalance" class="balance">188,50 ₺</span></div>
    <div><strong>Gider</strong><br><span id="sumExpenses" class="expense">811,50 ₺</span></div>
  </div>

<script>
// Demo veri - gerçek uygulamada backend'den gelir
let settings = {
  monthlyFee: 100,
  previousCarryOver: 0,
  year: 2025
};

let members = [
  {id: '1', name: 'İsmail', payments: {'2025-08': true, '2025-09': true}},
  {id: '2', name: 'Ali', payments: {'2025-08': true, '2025-09': true}},
  {id: '3', name: 'Özgür', payments: {'2025-08': true}},
  {id: '4', name: 'İsmail', payments: {'2025-08': true, '2025-09': true}},
  {id: '5', name: 'Mehmet', payments: {}},
  {id: '6', name: 'Murat', payments: {}}
];

let expenses = [
  {id: '1', date: '2025-08-11', type: 'Temizlik', description: 'Temizlik kimyasalları ve vileda (İsmail 4)', amount: 811.50}
];

function getMonths(){
  return Array.from({length:12}, (_,i)=> `${settings.year}-${String(i+1).padStart(2,'0')}`);
}

function monthLabel(ym){
  const m = ym.split('-')[1];
  return ['Oca','Şub','Mar','Nis','May','Haz','Tem','Ağu','Eyl','Eki','Kas','Ara'][Number(m)-1];
}

function calculateSummary() {
  const months = getMonths();
  const totalCollected = members.reduce((sum, m) => 
    sum + months.reduce((s, month) => s + (m.payments?.[month] ? settings.monthlyFee : 0), 0), 0);
  const totalExpenses = expenses.reduce((sum, e) => sum + e.amount, 0);
  const balance = settings.previousCarryOver + totalCollected - totalExpenses;
  return { totalCollected, totalExpenses, balance };
}

function renderSettings(){
  document.getElementById('year').textContent = settings.year;
  document.getElementById('expenseYear').textContent = settings.year;
  monthlyFee.value = settings.monthlyFee;
  previousCarry.value = settings.previousCarryOver;
  setYear.value = settings.year;
}

function renderMembers(){
  const months = getMonths();
  let html = '<div class="grid">';
  html += '<div class="header">Üye Adı</div>';
  months.forEach(m => html += `<div class="header">${monthLabel(m)}</div>`);
  html += '<div class="header">Sil</div>';
  
  members.forEach(mem=>{
    html += `<div class="cell name-cell">${mem.name}</div>`;
    months.forEach(m=>{
      const paid = mem.payments && mem.payments[m];
      const cls = paid ? 'cell paid' : 'cell unpaid';
      html += `<div class="${cls}" data-member="${mem.id}" data-ym="${m}">${paid ? '✓' : ''}</div>`;
    });
    html += `<div class="cell"><button class="delete-btn" data-del="${mem.id}">X</button></div>`;
  });
  html += '</div>';
  document.getElementById('membersTable').innerHTML = html;
}

function renderExpenses(){
  const tbody = document.querySelector('#expensesTbl tbody');
  tbody.innerHTML = expenses.map(e=>
    `<tr><td>${e.date}</td><td>${e.type||''}</td><td>${e.description||''}</td><td style="text-align:right">${e.amount.toFixed(2)} ₺</td><td><button class="delete-btn" data-expdel="${e.id}">Sil</button></td></tr>`
  ).join('');
}

function renderSummary(){
  const summary = calculateSummary();
  document.getElementById('sumCollected').textContent = summary.totalCollected.toFixed(2) + ' ₺';
  document.getElementById('sumExpenses').textContent = summary.totalExpenses.toFixed(2) + ' ₺';
  document.getElementById('sumBalance').textContent = summary.balance.toFixed(2) + ' ₺';
}

function render(){
  renderSettings();
  renderMembers();
  renderExpenses();
  renderSummary();
}

// Event handlers
saveSettings.onclick = () => {
  settings.monthlyFee = parseFloat(monthlyFee.value) || 100;
  settings.previousCarryOver = parseFloat(previousCarry.value) || 0;
  settings.year = parseInt(setYear.value) || 2025;
  render();
};

addMember.onclick = () => {
  const name = newMemberName.value.trim();
  if(!name) return;
  members.push({
    id: Date.now().toString(),
    name: name,
    payments: {}
  });
  newMemberName.value = '';
  render();
};

addExpense.onclick = () => {
  if(!expenseDate.value || !expenseAmount.value) return;
  expenses.push({
    id: Date.now().toString(),
    date: expenseDate.value,
    type: expenseType.value,
    description: expenseDesc.value,
    amount: parseFloat(expenseAmount.value) || 0
  });
  expenseDate.value = expenseType.value = expenseDesc.value = expenseAmount.value = '';
  render();
};

// Delegated clicks
membersTable.addEventListener('click', e => {
  const cell = e.target.closest('.cell');
  if(cell && cell.dataset.member && cell.dataset.ym){
    const member = members.find(m => m.id === cell.dataset.member);
    if(member) {
      if(!member.payments) member.payments = {};
      member.payments[cell.dataset.ym] = !member.payments[cell.dataset.ym];
      render();
    }
  }
  if(e.target.dataset.del){
    members = members.filter(m => m.id !== e.target.dataset.del);
    render();
  }
});

document.querySelector('#expensesTbl').addEventListener('click', e => {
  if(e.target.dataset.expdel){
    expenses = expenses.filter(exp => exp.id !== e.target.dataset.expdel);
    render();
  }
});

// Set today's date as default
document.getElementById('expenseDate').value = new Date().toISOString().split('T')[0];

// Initial render
render();
</script>
</body>
</html>
